!function(r,n,g){function p(){return s.short_name?U+"//"+s.short_name+"."+e.DOMAIN:e.REMOTE}function ec(){function t(){for(;t=en.shift();){var t,s=t.url,n=new e(t.title,{dir:"auto",icon:t.iconUrl,body:t.body});try{n.onclick=function(){r.focus(),E.href=s,n.close()}}catch(e){}setTimeout(function(){n.close&&n.close()},8e3)}}var e=r.Notification;"Notification"in r&&"denied"!==e.permission&&("granted"===e.permission&&t(),e.requestPermission(function(e){"granted"===e&&t()}))}function w(){return 0==l.data.user_id}function Z(t){e.theme=t,"none"!=t&&i.injectStylesheet(e.STATIC_URL+"/styles/embed"+(t?"."+t+".css?"+er[t]:"."+short_name)+".css")}if(i={},ee=n.getElementsByTagName("head")[0]||n.getElementsByTagName("body")[0],i.extend=function(e,t){for(var n in t)e[n]=t[n];return e},i.injectScript=function(o,s){var e=n.createElement("script"),t=n.head||n.getElementsByTagName("head")[0]||n.documentElement;e.type="text/javascript",e.src=o,e.async="async",e.charset="utf-8",s&&(e.onload=e.onreadystatechange=function(i,n){var o=n||!e.readyState||/loaded|complete/.test(e.readyState);o&&(e.onload=e.onreadystatechange=null,t&&e.parentNode&&t.removeChild(e),e=g,n||s.call(r))}),t.insertBefore(e,t.firstChild)},i.injectStylesheet=function(t){var e=n.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,ee.appendChild(e)},i.injectStyle=function(t){var e=n.createElement("style");return e.type="text/css",ee.appendChild(e),t=t.replace(/\}/g,"}\n"),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(n.createTextNode(t)),e},i.getCookie=function(r){for(var e,s,o,i=" "+r+"=",a=n.cookie.split(";"),t=0;t<a.length;t++)if(e=" "+a[t],s=e.indexOf(i),s>=0&&s+i.length==(o=e.indexOf("=")+1))return decodeURIComponent(e.substring(o,e.length).replace(/\+/g,""));return g},i.param=function(e){var n=[],t;for(t in e)e[t]!=g&&n.push(t+"="+encodeURIComponent(e[t]));return n.join("&")},i.cssProperty=function(e,i){if(s=(n.body||n.documentElement).style,"undefined"==typeof s)return!1;if("string"==typeof s[e])return!i||e;for(var s,o=["Moz","Webkit","ms"],e=e.charAt(0).toUpperCase()+e.substr(1),t=0;t<o.length;t++)if("string"==typeof s[o[t]+e])return!i||o[t]+e},!r.DUOSHUO){for(ed in Object.prototype)return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法");var i,ee,ed,s,c,f=r.JSON,E=r.location,K=r.XMLHttpRequest,u=f&&f.stringify&&r.localStorage,G=r.navigator.userAgent,U="https:"==n.location.protocol?"https:":"http:",I=0,en=[],v=c=function(){function e(e){return t[e]||"&amp;"}var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[<>"'`]/g,s=/[&<>"'`]/;return function(t){return null==t||t===!1?"":s.test(t)?t.replace(n,e):t}}(),ei=function(e){if(e.match(/^(http|https):/))return e;var t=n.createElement("a");return t.href=e,h.hrefNormalized?t.href:t.getAttribute("href",4)},et=function(e){return function(){return e}},F=function(){for(var t={},e=0,n;e<arguments.length;e++)arguments[e]&&i.extend(t,arguments[e]);return n=i.param(t),n?"?"+n:""},Y=function(){var e=i.getCookie("duoshuo_token");return e?{jwt:e}:s.remote_auth?{short_name:s.short_name,remote_auth:s.remote_auth}:g},B=function(){if(!s&&(s=r.duoshuoQuery)){if(!s.short_name||"your_duoshuo_short_name"===s.short_name)return s=g,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");X.trigger("queryDefined")}return s},b=function(e){return e&&e.error&&e.warn?e:{error:function(){},log:function(){},warn:function(){}}}(r.console),e=r.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(n){var t=e.parseDate(n);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(o){var n=e.parseDate(o),s=new Date,t=(s-I-n)/1e3;return 10>t?"刚刚":60>t?Math.round(t)+"秒前":3600>t?Math.round(t/60)+"分钟前":86400>t?Math.round(t/3600)+"小时前":(s.getFullYear()==n.getFullYear()?"":n.getFullYear()+"年")+(n.getMonth()+1)+"月"+n.getDate()+"日"},compileStyle:function(e){var t="",n={},s;if(n.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!e)return t;for(s in e)t+=n[s]+"{"+e[s]+"}\n";return t},init:function(t,n){t&&!S[t]&&(S[t]=n||{type:"EmbedThread"}),e.initView&&e.initView()}},ea=n.all,h=e.support=function(){t=n.createElement("div"),t.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var t,s=t.getElementsByTagName("a")[0],o=t.getElementsByTagName("input")[0],e={placeholder:"placeholder"in o,touch:"ontouchstart"in r||"onmsgesturechange"in r,opacity:/^0.55$/.test(s.style.opacity),hrefNormalized:"/a"===s.getAttribute("href"),iOS:G.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:G.match(/ \(Linux; U; Android /)};return e.ie6=!K&&"undefined"==typeof t.style.maxHeight,e.authInWin=r.postMessage&&r.screen.width>800&&!e.iOS&&!e.android&&E.origin,e}(),S=e.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},C=e.openDialog=function(n){return e.dialog!==g&&e.dialog.el.remove(),e.dialog=new a.Dialog(t.dialog(n)).open()},Q=e.smilies={},k,T,d,J;e.require=function(){function n(t){var n=es[t]?"?"+es[t]+".js":"";return e.STATIC_URL+"/libs/"+t+".js"+n}var t={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(t["embed.compat"]=!0,e.jQuery=r.jQuery),function(e,o){if("string"==typeof e)t[e]?o():i.injectScript(n(e),function(){t[e]=!0,o()});else if("object"==typeof e){var s,a=!0;for(s=0;s<e.length;s++)(function(r){t[e[s]]||(a=!1,i.injectScript(n(r),function(){t[r]=!0;for(var n=0;n<e.length;n++)if(!t[e[n]])return;o()}))})(e[s]);a&&o()}}}();for(k=0,T=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];k<T.length;k++)e[T[k]]=function(t){return function(s,n){n=n||{},n.type=t,s&&!S[s]&&(S[s]=n),e.initSelector&&e.initSelector(s,n)}}(T[k]),e["create"+T[k]]=function(t){return function(a,o){var s=n.createElement(a),i;for(i in o)s.setAttribute("data-"+i,o[i]);return e[t](s),s}}(T[k]);e.RecentCommentsWidget=e.RecentComments,d=e.API={ajax:function(a,h,n,r,c){function y(t){var e=t.getResponseHeader("Date");e&&(I=new Date-new Date(e))}function l(s,l,o){var n,i,a,e=l;if(s>=200&&300>s||304===s)if(304===s)e="notmodified",a=!0;else try{n=f.parse(o),e="success",a=!0}catch(t){e="parsererror",i=t}else{i=e,(!e||s)&&(e="error",0>s&&(s=0));try{n=f.parse(o)}catch(t){e="parsererror",i=t}}a?r&&r(n):"parseerror"===e?b.error("解析错误: "+o):(b.error("出错啦("+n.code+"): "+n.errorMessage),c&&c(n),n.errorTrace&&b.error(n.errorTrace)),y(t)}if(u=i.getCookie("duoshuo_token"),n=n||{},n.v=e.version,u?n.jwt=u:s.remote_auth&&(n.remote_auth=s.remote_auth),v=K&&f&&f.parse,v){var u,v,t=new K,j=!!t&&"withCredentials"in t,o,m;if(j)return t.open(a,p()+"/api/"+h+".json"+("GET"==a?"?"+i.param(n):""),!0),t.withCredentials=!0,t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.send("GET"==a?null:i.param(n)),o=function(r,e){var i,n,a,s;try{if(o&&(e||4===t.readyState))if(o=g,e)4!==t.readyState&&t.abort();else{i=t.status,a=t.getAllResponseHeaders();try{s=t.responseText}catch(e){}try{n=t.statusText}catch(e){n=""}}}catch(t){e||l(-1,t)}s&&l(i,n,s,a)},void(4===t.readyState?o():t.onreadystatechange=o)}"GET"!=a&&(n._method="POST"),m="cb_"+Math.round(1e6*Math.random()),d[m]=function(e){switch(e.code){case 0:r&&r(e);break;default:c&&c(e),b.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&b.error(e.errorTrace)}},n.callback="DUOSHUO.API['"+m+"']",i.injectScript(p()+"/api/"+h+".jsonp?"+i.param(n))},get:function(e,t,n,s){return this.ajax("GET",e,t,n,s)},post:function(e,t,n,s){return this.ajax("POST",e,t,n,s)}},J=e.ws={messages:[],send:function(o){if(!("WebSocket"in r&&f))return!1;if(t=this,t.messages.push(f.stringify(o)),!t.webSocket){var t,i="https:"===n.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",s=t.webSocket=new WebSocket(i);s.onopen=function(){var e,n=1===s.readyState;if(n)for(;e=t.messages.shift();)s.send(e)},s.onmessage=function(o){try{var t=f.parse(o.data),n,s}catch(e){return}switch(t.type){case"post":for(s=0;s<e.pagelets.length;s++)n=e.pagelets[s],n.threadId==t.thread_id&&n.onMessage(t);break;case"notification":en.push(t),ec()}},r.addEventListener("beforeunload",function(){s.close()})}t.webSocket.onopen()}},e.DOMAIN="duoshuo.com",e.STATIC_URL=U+"//static.duoshuo.com",e.REMOTE=U+"//duoshuo.com",e.version="15.11.15";var er={default:"79dc948b",dark:"ddc346d8",bluebox:"0f0f035c",newhua:"dc453ca2"},es={"embed.compat":"24f8ca3f",smilies:"921e8eda"},o={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报",delete:"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},L={get:function(e){return u?u[e]:void 0},save:function(e,t){if(u)try{u.removeItem(e),u[e]=f.stringify(t),u.removeItem(e+":timestamp"),u[e+":timestamp"]=Math.floor((new Date-I)/1e3)}catch(e){}}},R=e.loadRequire=function(t){if(t.visitor&&(!l.data&&t.visitor.user_id&&r.Notification&&J.send({logged_user_id:t.visitor.user_id}),l.reset(t.visitor)),t.site&&(_.reset(t.site),L.save("ds_site_"+s.short_name,t.site)),!e.theme&&_.data.theme&&Z(_.data.theme),t.lang&&(i.extend(o,t.lang),L.save("ds_lang_"+s.short_name,t.lang)),t.stylesheets)for(var n=0;n<t.stylesheets.length;n++)i.injectStylesheet(t.stylesheets[n]);if(t.nonce&&(e.nonce=t.nonce),t.style&&i.injectStyle((t.style||"")+e.compileStyle(s.component_style)),t.unread&&O.reset(t.unread),t.warnings)for(n=0;n<t.warnings.length;n++)b.warn(t.warnings[n])},V=0,eo=e.Class=function(){};eo.extend=function(t){function e(){!V&&this.init&&this.init.apply(this,arguments)}V=1;var n=new this,s;V=0;for(s in t)n[s]=t[s];return e.prototype=n,e.prototype.constructor=e,e.extend=arguments.callee,e};var D=e.Event=eo.extend({on:function(e,n){var t=this.handlers||(this.handlers={});return t[e]===g&&(t[e]=[]),t[e].push(n),this},trigger:function(n,s){var e=(this.handlers||(this.handlers={}))[n],t;if(e)for(t=0;t<e.length&&e[t].call(this,s)!==!1;t++);return this}}),y=e.Widget=D.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){switch(e.code){case 0:R(e);var t=this.prepare(e);t.options=i.extend(this.options,e.options),this.onload(t);break;default:this.onError(e)}},onload:function(e){this.el.html(t[this.tmpl](e))},prepare:function(e){return e},onMessage:function(){},onError:function(e){b.error("出错啦("+e.code+"): "+e.errorMessage),e.errorTrace&&b.error(e.errorTrace)}}),M=e.Model=D.extend({init:function(e){this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},set:function(e,t){if(t===g)for(var n in e)this.data[n]=e[n];else this.data[e]=t;return this.trigger("reset"),this},toJSON:function(){return i.extend({},this.data)}}),H=M.extend({toJSON:function(){return i.extend({},this.data)}}),N=M.extend({toJSON:function(){var e=i.extend({},this.data);return e.theAuthor=x[this.data.author_id]&&x[this.data.author_id].data||this.data.author,e.parents=this.data.parents||[],e}}),$=M.extend({toJSON:function(){return i.extend({},this.data)}}),A=function(e){this.model=e};A.prototype.set=function(t){for(var e in t)t[e]&&(this[e]?this[e].set(t[e]):this[e]=new this.model(t[e]))},A.prototype.get=function(t){for(var e=0,n=[];e<t.length;e++)n[e]=this[t[e]];return n},A.prototype.getJSON=function(t){for(var e=0,n=[];e<t.length;e++)this[t[e]]&&n.push(this[t[e]].toJSON());return n};var j={userUrl:function(e){return e.url},avatarUrl:function(e){return document.location.protocol=="https:"&&(e.avatar_url?(e.avatar_url=e.avatar_url.replace(/^http:\/\//,"https://"),e.avatar_url=e.avatar_url.replace(/himg\.bdimg\.com/,"nzriuc44h.qnssl.com"),e.avatar_url=e.avatar_url.replace(/ds\.cdncache\.org/,"nzrisok3d.qnssl.com"),e.avatar_url=e.avatar_url.replace(/img\.kaixin001\.com\.cn/,"nzrktdox3.qnssl.com"),e.avatar_url=e.avatar_url.replace(/img\d+\.douban\.com/,"img1.doubanio.com"),e.avatar_url=e.avatar_url.replace(/app\.qlogo\.cn/,"nzvcelvwu.qnssl.com"),e.avatar_url=e.avatar_url.replace(/wx\.qlogo\.cn/,"nzwsf9aei.qnssl.com"),e.avatar_url=e.avatar_url.replace(/tp\d+\.sinaimg\.cn/,"odfhb4m72.qnssl.com"),e.avatar_url=e.avatar_url.replace(/tva\d+\.sinaimg\.cn/,"wbimg-tva2.b0.upaiyun.com"),e.avatar_url=e.avatar_url.replace("img.t.sinajs.cn","nznlz6ohs.qnssl.com"),e.avatar_url=e.avatar_url.replace("0.gravatar.com/avatar","cdn.v2ex.com/gravatar")):_.data.default_avatar_url=_.data.default_avatar_url.replace(/^http:\/\//,"https://")),e.avatar_url||_.data.default_avatar_url},loginUrl:function(t,e){return e||(e={}),s.sso&&s.sso.login&&(e.sso=1,e.redirect_uri=s.sso.login),p()+"/login/"+t+"/"+F(e)},bindUrl:function(e){return p()+"/bind/"+e+"/"+F(s.sso&&s.sso.login?{sso:1,redirect_uri:s.sso.login}:null,Y())},logoutUrl:function(){return p()+"/logout/"+F(s.sso&&s.sso.logout?{sso:1,redirect_uri:s.sso.logout}:null)}},q=["weixin","weibo","qq","renren"],P=["douban","kaixin","baidu","google"],t=e.templates={userAnchor:function(e){return e.url?'<a rel="nofollow author" target="_blank" href="'+v(e.url)+'">'+v(e.name)+"</a>":v(e.name)},avatarImg:function(t,e){return'<img src="'+v(j.avatarUrl(t,e))+'" alt="'+v(t.name)+'"'+(e?' style="width:'+e+"px;height:"+e+'px"':"")+"/>"},avatar:function(e,o){var n=t.avatarImg(e,o),s=j.userUrl(e);return s?'<a rel="nofollow author" target="_blank" href="'+v(s)+'" '+(e.user_id?" onclick=\"this.href='"+p()+"/user-url/?user_id="+e.user_id+"';\"":"")+' title="'+v(e.name)+'">'+n+"</a>":n},timeText:function(t){return t?'<span class="ds-time" datetime="'+t+'" title="'+e.fullTime(t)+'">'+e.elapsedTime(t)+"</span>":""},timeAnchor:function(t,n){return t?'<a href="'+n+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+t+'" title="'+e.fullTime(t)+'">'+e.elapsedTime(t)+"</a>":""},serviceIcon:function(t,n){return'<a href="javascript:void(0)" class="ds-service-icon'+(n?"-grey":"")+" ds-"+t+'" data-service="'+t+'" title="'+e.sourceName[t]+'"></a>'},poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+v(e)+"</a></p>"},indicator:et('<div id="ds-indicator"></div>'),waitingImg:et('<div id="ds-waiting"></div>'),loginItem:function(t,n){var s=j[n?"bindUrl":"loginUrl"](t);return'<li>    <a href="'+s+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+e.serviceNames[t]+(l.data.social_uid[t]?' <span class="ds-icon ds-icon-ok"></span>':"")+"</a></li>"}},W=function(e){var t=[],n;for(n in e)t.push('<input type="hidden" name="'+n+'" value="'+v(e[n])+'" />');return t.join("\n")};t.commentList=function(s){var n="",o=s.list,e,i,a;if(o)for(i=-1,a=o.length-1;a>i;)e=o[i+=1],n+='<li class="ds-comment',s.options.show_avatars&&(n+=" ds-show-avatars"),n+='" data-post-id="'+e.post_id+'">',s.options.show_avatars&&(n+='<div class="ds-avatar">'+t.avatar(e.theAuthor,s.options.avatar_size)+"</div>"),n+='<div class="ds-meta">'+t.userAnchor(e.theAuthor),s.options.show_time&&(n+=t.timeText(e.created_at)),n+="</div>",n+=s.options.show_title?'<div class="ds-thread-title">在 <a href="'+c(e.thread.url)+'#comments">'+c(e.thread.title)+'</a> 中评论</div><div class="ds-excerpt">'+e.message+"</div>":'<a class="ds-excerpt" title="'+e.thread.title+' 中的评论" href="'+c(e.thread.url)+'#comments">'+e.message+"</a>",n+="</li>";return n},t.ctxPost=function(n){var s="";return n.post.message=n.post.message.replace(/src=(["|'])http:\/\//g,"src=$1//nznlz6ohs.qnssl.com/"),n.post.message=n.post.message.replace("img.t.sinajs.cn/",''),n.post&&(s+='<li class="ds-ctx-entry"',n.hidden&&(s+=' style="display:none"'),s+=' data-post-id="'+n.post.post_id+'"><div class="ds-avatar">'+t.avatar(n.post.theAuthor||n.post.author)+'</div><div class="ds-ctx-body"><div class="ds-ctx-head">'+t.userAnchor(n.post.theAuthor||n.post.author)+t.timeAnchor(n.post.created_at,n.post.url),n.index>=0&&(s+='<div class="ds-ctx-nth" title="'+e.fullTime(n.post.created_at)+'">'+(n.index+1)+o.floor+"</div>"),s+='</div><div class="ds-ctx-content">'+n.post.message,n.index>=0&&(s+='　　　　　　　<div class="ds-comment-actions',n.post.vote>0&&(s+=" ds-post-liked"),s+='">'+t.likePost(n.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+o.repost+'</a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+o.reply+"</a></div>"),s+="</div></div></li>"),s},t["dialog-anonymous"]=function(n){var t='<h2>社交帐号登录</h2><div class="ds-icons-32">',o=n.services,s,i,a;if(o)for(i=-1,a=o.length-1;a>i;)s=o[i+=1],t+='<a class="ds-'+s+'" href="'+j.loginUrl(s)+'">'+e.sourceName[s]+"</a>";return t+="</div>",n.options.deny_anonymous||(t+='<h2>作为游客留言</h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+c(l.data.name)+'" required /><label for="ds-dialog-name">名字(必填)</label></div>',n.options.require_guest_email&&(t+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+c(l.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)</label></div>'),n.options.require_guest_url&&(t+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+c(l.data.url)+'" /><label for="ds-dialog-url">网址(可选)</label></div>'),t+='<button type="submit">发布</button></form>'),t},t["dialog-ask-for-auth"]=function(){var e='<h2>社交帐号登录</h2><ul class="ds-service-list">'+t.serviceList(q)+'</ul><ul class="ds-service-list ds-additional-services">'+t.serviceList(P)+"</ul>";return e},t["dialog-bind-more"]=function(){var e='<h2>绑定更多帐号</h2><ul class="ds-service-list">'+t.serviceBindList(q)+'</ul><ul class="ds-service-list ds-additional-services">'+t.serviceBindList(P)+'</ul><div style="clear:both"></div>';return e},t["dialog-qrcode"]=function(e){var t='<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+e.qrcode_url+'" alt="'+e.url+'"></div>';return t},t["dialog-reposts"]=function(t){var e='<h2>转发到微博</h2><div class="ds-quote"><strong>@'+c(t.post.theAuthor.name)+"</strong>: "+t.post.message+"</div><form>"+W({post_id:t.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+c(o.repost_reason)+'">'+c(t.repostMessage)+'</textarea><pre class="ds-hidden-text"></pre>';return e+='</div><div class="ds-actions">',t.service?e+=W({"service[]":t.service}):(e+='<label><input type="checkbox" name="service[]" value="weibo"',l.data.social_uid.weibo&&(e+=' checked="checked"'),e+=' /><span class="ds-service-icon ds-weibo"></span>新浪微博</label><label><input type="checkbox" name="service[]" value="qqt"',l.data.social_uid.qq&&(e+=' checked="checked"'),e+=' /><span class="ds-service-icon ds-qqt"></span>腾讯微博</label>'),e+='<button type="submit">'+o.repost+"</button></div></form>"},t.dialog=function(e){var t='<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+e+'</div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"></a></div></div>';return t},t.hotPosts=function(n){var s='<div class="ds-header ds-gradient-bg">'+c(o.hot_posts_title)+"</div><ul>",e=n.list,i,a,r;if(e)for(a=-1,r=e.length-1;r>a;)i=e[a+=1],s+=t.post({post:i,options:n.options});return s+="</ul>"},t.likePost=function(e){var t='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span>'+o.like;return e.likes>0&&(t+="("+e.likes+")"),t+="</a>"},t.likeTooltip=function(t){var n='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：</p><ul>',e;for(e in t.services)n+='<li><a class="ds-share-to-'+e+" ds-service-link ds-"+e+'" href="'+p()+"/share-proxy/?"+i.param({service:e,thread_id:t.thread_id})+'">'+t.services[e]+"</a></li>";return n+='</ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了</a></p></div>'},t.loginButtons=function(){var e='<div class="ds-login-buttons"><p>社交帐号登录:</p><div class="ds-social-links"><ul class="ds-service-list">'+t.serviceList(q)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»</a></li></ul><ul class="ds-service-list ds-additional-services">'+t.serviceList(P)+"</ul></div></div>";return e},t.loginWidget=function(i){var s='<div class="ds-icons-32">',n=i,t,o,a;if(n)for(o=-1,a=n.length-1;a>o;)t=n[o+=1],s+='<a class="ds-'+t+'" href="'+j.loginUrl(t)+'">'+e.sourceName[t]+"</a>";return s+="</div>"},t.meta=function(t){var e='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return t.user_vote>0&&(e+=" ds-thread-liked"),e+='"><span class="ds-icon ds-icon-heart"></span> <span class="ds-thread-like-text">',e+=t.user_vote>0?"已喜欢":"喜欢",e+='</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel"></span></div>'},t.notify=function(e){var t='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li';return e.comments||(t+=' style="display:none;"'),t+='><a data-type="unread-comments" href="javascript:void(0);">你有'+e.comments+"条新回复</a></li><li",e.notifications||(t+=' style="display:none;"'),t+='><a data-type="unread-notifications" href="javascript:void(0);">你有'+e.notifications+"条系统消息</a></li></ul></div>"},t.post=function(u){var s="",n=u.post,r=u.options,i=n.author,l,h,a,f,d,g;if(document.location.protocol=="https:"&&n.message.indexOf("static.duoshuo.com")=="-1"&&(n.message=n.message.replace(/src=(["|'])http:\/\//g,"src=$1//nznlz6ohs.qnssl.com/")),n.message.indexOf("static.duoshuo.com")!="-1"&&(n.message=n.message.replace(/src=(["|'])http:\/\//g,"src=$1https://")),n.message=n.message.replace(/_org.gif/g,"_thumb.gif"),s+='<li class="ds-post" data-post-id="'+n.post_id+'"><div class="ds-post-self" data-post-id="'+n.post_id+'" data-thread-id="'+n.thread_id+'" data-root-id="'+n.root_id+'" data-source="'+n.source+'"><div class="ds-avatar"',i.user_id&&(s+=' data-user-id="'+i.user_id+'"'),s+=">"+t.avatar(i),e.sourceName[n.source]&&(s+=t.serviceIcon(n.source)),s+='</div><div class="ds-comment-body"><div class="ds-comment-header">',i.url?(s+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(i.qqt_account||"")+'" href="'+c(i.url)+'" ',i.user_id&&(s+=" onclick=\"this.href='"+p()+"/user-url/?user_id="+i.user_id+"';\""),s+=' rel="nofollow" target="_blank"',i.user_id&&(s+=' data-user-id="'+i.user_id+'"'),s+=">"+c(i.name)+"</a>"):(s+='<span class="ds-user-name"',i.user_id&&(s+=' data-user-id="'+i.user_id+'"'),s+=' data-qqt-account="'+(i.qqt_account||"")+'">'+c(i.name)+"</span>"),s+="</div>",1==r.max_depth&&r.show_context&&n.parents.length){if(s+='<ol id="ds-ctx">',l=m.getJSON(n.parents),l)for(a=-1,f=l.length-1;f>a;)h=l[a+=1],1==a&&n.parents.length>2&&(s+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(n.parents.length-2)+"条评论</a></li>"),s+=t.ctxPost({post:h,index:a,hidden:a&&a<n.parents.length-1});s+="</ol>"}if(s+="<p>",n.parents.length>=r.max_depth&&(!r.show_context||r.max_depth>1)&&n.parent_id&&m[n.parent_id]&&(s+='<a class="ds-comment-context" data-post-id="'+n.post_id+'" data-parent-id="'+n.parent_id+'">'+o.reply_to+c(m[n.parent_id].toJSON().author.name)+": </a>"),s+=n.message+'</p><div class="ds-comment-footer ds-comment-actions',n.vote>0&&(s+=" ds-post-liked"),s+='">',s+=n.url?t.timeAnchor(n.created_at,n.url):t.timeText(n.created_at),"duoshuo"==n.source?(s+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"></span>'+o.reply+"</a>"+t.likePost(n)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>'+o.repost+'</a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>'+o.report+"</a>",n.privileges.delete&&(s+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"></span>'+o.delete+"</a>")):("qqt"==n.source||"weibo"==n.source)&&(s+='<a class="ds-weibo-comments" href="javascript:void(0);">'+o.comments,n.type.match(/-comment$/)||(s+='(<span class="ds-count">'+n.comments+"</span>)"),s+='</a><a class="ds-weibo-reposts" href="javascript:void(0);">'+o.reposts,n.type.match(/-comment$/)||(s+='(<span class="ds-count">'+n.reposts+"</span>)"),s+="</a>"),s+="</div></div></div>",r.max_depth>1&&(n.childrenArray||n.children)&&"weibo"!=n.source&&"qqt"!=n.source){if(s+='<ul class="ds-children">',d=m.getJSON(n.childrenArray||n.children),d)for(a=-1,g=d.length-1;g>a;)n=d[a+=1],s+=t.post({post:n,options:r});s+="</ul>"}return s+="</li>"},t.postListHead=function(e){var t='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+o.latest+'</a><a class="ds-order-asc">'+o.earliest+'</a><a class="ds-order-hot">'+o.hottest+'</a></div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"></a></li>';return e.options.show_reposts&&e.thread.reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_weibo&&e.thread.weibo_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"></a></li>'),t+=" ",e.options.show_qqt&&e.thread.qqt_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"></a></li>'),t+="</ul></div>"},t.recentVisitors=function(n){var s="",e=n.response,o,i,a;if(e)for(i=-1,a=e.length-1;a>i;)o=e[i+=1],s+='<div class="ds-avatar">'+t.avatar(o,n.options.avatar_size)+"</div>";return s},t.replybox=function(s){var n='<div class="ds-replybox"><a class="ds-avatar"',i;if(n+=w()?' href="javascript:void(0);" onclick="return false"':' href="'+e.REMOTE+"/settings/avatar/"+F(Y())+'" target="_blank" title="设置头像"',n+=">"+t.avatarImg(l.data)+'</a><form method="post">'+W(s.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+c(o.leave_a_message)+'"></textarea><pre class="ds-hidden-text"></pre>',n+="</div>",n+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!w()&&l.data.repostOptions){n+='<input id="ds-sync-checkbox',s.inline&&(n+="-inline"),n+='" type="checkbox" name="repost" ',s.checked&&(n+='checked="checked" '),n+='value="'+s.repostArray.join(",")+'"> <label for="ds-sync-checkbox',s.inline&&(n+="-inline"),n+='">'+o.share_to+"</label>";for(i in l.data.repostOptions)n+=t.serviceIcon(i,!l.data.repostOptions[i])}return n+="</span>",n+="</div>",n+='<button class="ds-post-button" type="submit">'+c(o.post)+'</button><div class="ds-toolbar-buttons">',s.options.use_smilies&&(n+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"></a>'),s.options.use_images&&s.options.parse_html_enabled&&(n+='<a class="ds-toolbar-button ds-add-image" title="插入图片"></a>'),n+="</div></div>",n+="</form></div>"},t.serviceBindList=function(i){var n="",s=i,t,o,a;if(s)for(o=-1,a=s.length-1;a>o;)t=s[o+=1],n+='<li><a href="'+j.bindUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+e.serviceNames[t],l.data.social_uid[t]&&(n+=' <span class="ds-icon ds-icon-ok"></span>'),n+="</a></li>";return n},t.serviceList=function(i){var s="",n=i,t,o,a;if(n)for(o=-1,a=n.length-1;a>o;)t=n[o+=1],s+='<li><a href="'+j.loginUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+e.serviceNames[t]+"</a></li>";return s},t.shareWidget=function(s){var o='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',n=s.services,t,i,a;if(n)for(i=-1,a=n.length-1;a>i;)t=n[i+=1],o+=' <li> <a class="ds-'+t+'" href="javascript:void(0);" data-service="'+t+'">'+e.sourceName[t]+"</a> </li> ";return o+=' </ul> </div> <div class="ds-share-icons-footer">'+s.copyright+"</div></div>"},t.smiliesTooltip=function(t){var e='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">',n;for(n in t)e+="<li><a>"+n+"</a></li>";return e+='</ul><div class="ds-smilies-container"></div></div>'},t.toolbar=function(){var t='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"></span> <span>帐号管理</span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="'+e.REMOTE+"/settings/"+F(Y())+'">'+c(o.settings)+'</a></li><li><a rel="nofollow" href="'+j.logoutUrl()+'" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor">';return t+=l.data.url?'<a class="ds-visitor-name" href="'+c(l.data.url)+'" target="_blank">'+c(l.data.name)+"</a>":'<span class="ds-visitor-name">'+c(l.data.name)+"</span>",t+='<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"></a></div></div>'},t.topThreads=function(o){var n="",t=o.response,e,s,i;if(t)for(s=-1,i=t.length-1;i>s;)e=t[s+=1],n+='<li><a target="_blank" href="'+c(e.url)+'" title="'+c(e.title)+'">'+c(e.title)+"</a></li>";return n},t.topUsers=function(s){var o="",e=s.response,n,i,a;if(e)for(i=-1,a=e.length-1;a>i;)n=e[i+=1],o+='<div class="ds-avatar">'+t.avatar(n,s.options.avatar_size)+"<h4>"+c(n.name)+"</h4></div>";return o},t.userInfo=function(n){var s='<a href="'+c(n.url)+'" onclick="this.href=\''+p()+"/user-url/?user_id="+n.user_id+'\';" class="ds-avatar" target="_blank">'+t.avatarImg(n)+'</a><a href="'+c(n.url)+'" onclick="this.href=\''+p()+"/user-url/?user_id="+n.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+c(n.name)+"</a>",o;for(o in n.social_uid)s+='<a href="'+e.REMOTE+"/user-proxy/"+o+"/"+n.social_uid[o]+'/" target="_blank" class="ds-service-icon ds-'+o+'" title="'+e.sourceName[o]+'"></a>';return s+='<p class="ds-user-card-meta"><a href="'+e.REMOTE+"/profile/"+n.user_id+'/" target="_blank"><span class="ds-highlight">'+n.comments+"</span>条评论</a></p>",n.description&&(s+='<p class="ds-user-description">'+c(n.description)+"</p>"),s};var a=e.Views={},el=(e.Callbacks={},e.pagelets=[]),X=e.events=new D,_=e.site=new M,l=e.visitor=new H,O=e.unread=new M,z=e.threadPool=new A($),m=e.postPool=new A(N),x=e.userPool=new A(H);X.on("queryDefined",function(){if(e=s.short_name,s.theme&&Z(s.theme),u){var e,t=u["ds_site_"+e],n=u["ds_lang_"+e];t&&_.reset(f.parse(t)),n&&i.extend(o,f.parse(n))}}),B(),e.require("embed.compat",function(){function V(e){e.stopPropagation()}function eo(e){(e.ctrlKey&&13==e.which||10==e.which)&&c(this.form).trigger("submit")}function en(){var e=c(this);e.height(Math.max(54,e.next(".ds-hidden-text").text(this.value).height()+27))}function k(){if(h.authInWin){var t=this.href.match(/\/(login|bind)\/(\w+)\//i);if(t&&e.serviceNames[t[2]])return!X(t[2],this.href)}}function ed(){var l,r,t,i,a,s=this,o=0,e=0;n.selection&&(r=n.selection.createRange(),r&&r.parentElement()==s&&(i=s.value.length,l=s.value.replace(/\r\n/g,"\n"),t=s.createTextRange(),t.moveToBookmark(r.getBookmark()),a=s.createTextRange(),a.collapse(!1),t.compareEndPoints("StartToEnd",a)>-1?o=e=i:(o=-t.moveStart("character",-i),o+=l.slice(0,o).split("\n").length-1,t.compareEndPoints("EndToEnd",a)>-1?e=i:(e=-t.moveEnd("character",-i),e+=l.slice(0,e).split("\n").length-1)))),c(s).data("ds-range-start",o).data("ds-range-end",e)}function P(e){return h.touch&&e.addClass("ds-touch"),i.cssProperty("transition")||e.addClass("ds-no-transition"),h.ie6&&e.addClass("ds-ie6"),h.opacity||e.addClass("ds-no-opacity"),e}function et(e){if(!h.placeholder){var t=e.attr("placeholder");e.val(t).focus(function(){this.value===t&&(this.value="")}).blur(function(){""===this.value&&(this.value=t)})}return e}function ee(e){if("http://duoshuo.com"===e.origin)switch(e.data.type){case"login":E.href=e.data.redirectUrl}}function X(n,e){var t={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[n]||[550,400];return r.open(e+(-1==e.indexOf("?")?"?":"&")+i.param({origin:E.origin||"http://"+E.host}),"_blank","width="+t[0]+",height="+t[1]+",toolbar=no,menubar=no,location=yes")}function K(e){var t=j[w()?"loginUrl":"bindUrl"](e);h.authInWin&&X(e,t)||(E.href=t)}function ec(){var e=C(t["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px");e.find("a.ds-service-link").click(k)}function U(c,u,o,s){function a(){function t(i){if(o&&s){var t=o.options,a=I(o.postList.el,i.response[s],t),n;"asc"==t.order==("top"==t.formPosition)&&e.scrollTo(a),n=o.el.find(".ds-comments-tab-"+s+" span.ds-highlight"),n.html(parseInt(n.html())+1)}}return s||n.find("[type=checkbox]:checked")[0]?(d.post("posts/repost",e.toJSON(n),t),i.close(),!1):(alert("还没有选发布到哪儿呢"),!1)}function r(){var e=this.value;return this.checked&&!l.data.social_uid["qqt"==e?"qq":e]?void K(e):void 0}var i=C(t["dialog-reposts"]({post:c.toJSON(),repostMessage:u,service:s})),n=i.el.find("form");return n.submit(a),n.find(".ds-actions [type=checkbox]").change(r),et(n.find("textarea")).keyup(eo).keyup(en).focus(),!1}function W(o){var n={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(e){return e.thread?'<li data-thread-id="'+e.thread.thread_id+'">'+c.map(e.authors,t.userAnchor).join("、")+' 在 <a class="ds-read" href="'+e.thread.url+'#comments" target="_blank">'+v(e.thread.title||"无标题")+'</a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>':""},read:function(e){var t=e.attr("data-thread-id");d.post("threads/read",{thread_id:t}),O.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了</a></li>'},read:function(e){var t=e.attr("data-notification-id");d.post("notifications/read",{notification_id:t}),O.data.notifications--}}}[o],s=C("<h2>"+n.title+'</h2><ul class="ds-unread-list"></ul>'),i;s.on("close",e.resetNotify),i=s.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return c(this).parent().remove(),0===i.children().length&&s.close(),!1}).delegate(".ds-read","click",function(){n.read(c(this).parent())}),c("#ds-notify").hide(),d.get(n.apiUrl,{},function(e){s.el.find(".ds-unread-list").html(c.map(e.response,n.tmpl).join("\n"))})}function q(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function Y(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,f.detach()},400)}function I(e,n,s){return e.find(".ds-post[data-post-id="+n.data.post_id+"]")[0]?void 0:(e.find(".ds-post-placeholder").remove(),c(t.post({post:n.toJSON(),options:s})).hide()["asc"==s.order?"appendTo":"prependTo"](e).slideDown(function(){}))}function Z(n,s){function o(){if(w())return ec(),!1;var e=c(this).parent(),t=e.hasClass("ds-post-liked"),n=c(this).html().match(/\((\d+)\)/),s=(n?parseInt(n[1]):0)+(t?-1:1);return d.post("posts/vote",{post_id:e.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:t?0:1}),c(this).html(c(this).html().replace(/\(\d+\)/,"")+(s?"("+s+")":"")),e[t?"removeClass":"addClass"]("ds-post-liked"),!1}function i(){var e=c(this).closest(".ds-post-self"),t=m[e.attr("data-post-id")];return U(t,""),!1}function r(){if(!confirm("确定要删除这条评论吗？"))return!1;var e=c(this).closest(".ds-post-self");return d.post("posts/remove",{post_id:e.attr("data-post-id")}),e.parent().fadeOut(200,function(){n.data.comments--,n.updateCounter("duoshuo"),c(this).remove()}),!1}function u(){if(!confirm("确定要举报这条评论吗？"))return!1;var e=c(this).closest(".ds-post-self");return d.post("posts/report",{post_id:e.attr("data-post-id")}),alert("感谢您的反馈！"),!1}function y(){var t=c(this),o=t.closest(".ds-comment-actions"),i;return o.hasClass("ds-reply-active")?(e.el.fadeOut(200,function(){c(this).detach()}),o.removeClass("ds-reply-active")):(i=t.closest(".ds-ctx-entry, .ds-post-self"),e?e.actionsBar.removeClass("ds-reply-active"):(e=new a.Replybox(n),e.render(!0).el.addClass("ds-inline-replybox").detach()),e.el.find("[name=parent_id]").val(i.attr("data-post-id")),e.el.show().appendTo(t.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),e.actionsBar=o.addClass("ds-reply-active"),s.max_depth<=1?e.postList=n.postList.el:(e.postList=i.siblings(".ds-children"),e.postList[0]||(e.postList=c('<ul class="ds-children"></ul>').insertAfter(i)))),!1}function p(){function o(e){R(e),n.append(c.map(e.response,function(e){return t.post({post:e,options:s})}).join(""))}{var e=c(this).closest(".ds-post-self"),i=e.attr("data-post-id"),n;e.data("source")}return 0==e.attr("data-root-id")&&(n=e.siblings(".ds-children"),n[0]?(n.remove(),!1):(n=c('<ul class="ds-children"></ul>').insertAfter(e),d.get("posts/listComments",F({post_id:i}),o),!1))}function g(){var r=c(this).closest(".ds-post-self"),e=m[r.attr("data-post-id")],t=e.data.source,o;if(!l.data.social_uid["qqt"==t?"qq":t])return void K(t);var s=e.data.root_id,a="0"!=s?m[s]:e,i="";return"0"!=s&&(o=prepatePost(e.data).theAuthor,i=("weibo"==t?"//@"+o.name:"|| @"+o.qqt_account)+":"+e.data.message),U(a,i,n,t),!1}function v(){var e=c(this).parent();return e.siblings().show(),e.remove(),!1}function b(){function o(){function h(n){var e=n.response;x[o]?x[o].set(e):x[o]=new H(e),f.owner==s&&M.html(t.userInfo(e))}A=0,f.owner=s,q();var c=e.offset(),a=n.el.offset(),r=e.innerWidth()/2,l=n.el.innerHeight()-(c.top-a.top)+6,u=c.left-a.left-35+(r>35?35:r),i,o;try{if(e.hasClass("ds-comment-context"))M.attr("id","ds-ctx-bubble").attr("data-post-id",e.attr("data-post-id")).html('<ul id="ds-ctx">'+t.ctxPost({post:m[e.attr("data-parent-id")].toJSON()})+'</ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话</a></div>');else if(e.hasClass("ds-avatar")||e.hasClass("ds-user-name")){if(i={},o=i.user_id=e.attr("data-user-id"),!o)throw"no info";M.attr("id","ds-user-card").attr("data-user-id",o).empty(),x[o]?M.html(t.userInfo(x[o].data)):d.get("users/profile",F(i),h)}f.css({bottom:l,left:u}).appendTo(n.innerEl)}catch(e){f.detach()}}var s=this,e;if(bubbleOutTimer&&f.owner==s)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);e=c(s),A=setTimeout(o,200)}function j(){A?(clearTimeout(A),A=0):bubbleOutTimer||Y()}var e;this.delegate("a.ds-post-likes","click",o).delegate("a.ds-post-repost","click",i).delegate("a.ds-post-delete","click",r).delegate("a.ds-post-report","click",u).delegate("a.ds-post-reply","click",y).delegate("a.ds-weibo-comments","click",p).delegate("a.ds-weibo-reposts","click",g).delegate("a.ds-expand","click",v),h.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",b).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",j)}function F(o){var e={require:"site,visitor,nonce,lang"+(er++?"":",unread,log,extraCss"),site_ims:L.get("ds_site_"+s.short_name+":timestamp"),lang_ims:L.get("ds_lang_"+s.short_name+":timestamp"),referer:n.referrer},t;s.stylePatch&&(e.style_patch=s.stylePatch);for(t in e)e[t]&&(!h.ie6||encodeURIComponent(e[t]).length<200)&&(o[t]=e[t]);return o}var c=e.jQuery,T=c(r),es=c(n),er;r.postMessage&&(r.addEventListener?r.addEventListener("message",ee,!1):r.attachEvent&&r.attachEvent("onmessage",ee)),e.scrollTo=function(t){var e=t.offset().top;(e<T.scrollTop()||e>T.scrollTop()+T.height())&&c("html, body").animate({scrollTop:e-40},200,"swing")},e.toJSON=function(n){var e=/\r?\n/g,s=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,o=/^(?:select|textarea)/i,i=n.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||o.test(this.nodeName)||s.test(this.type))}).map(function(s,n){var t=c(this).val();return null==t?null:c.isArray(t)?c.map(t,function(t){return{name:n.name,value:t.replace(e,"\r\n")}}):{name:n.name,value:t.replace(e,"\r\n")}}).toArray(),t={};return c.each(i,function(){t[this.name]=this.value}),t},e.resetNotify=function(){var e=c("#ds-notify"),s=O.data;e[0]||(e=c('<div id="ds-notify"></div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[_.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return W(c(this).data("type")),!1}).appendTo(n.body)),e.html(t.notify(s))[!s.comments&&!s.notifications||"hidden"===_.data.notify_position||c(".ds-dialog")[0]?"hide":"show"]()},O.on("reset",e.resetNotify),a.Replybox=function(e){this.embedThread=e},a.Replybox.prototype={render:function(T){function z(e){e.data("submitting",!0),e.find(".ds-post-button").addClass("ds-waiting").html(o.posting)[0].disabled=!0}function S(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html(o.post)[0].disabled=!1}var r=this,p=r.embedThread,f=p.options,E=function(){e.require("smilies",function(){})},y={thread:p,options:f,inline:T,params:{thread_id:p.threadId,parent_id:"",nonce:e.nonce},repostArray:[],checked:0};for(x in l.data.repostOptions)l.data.repostOptions[x]&&(y.repostArray.push(x),y.checked=1);var x,g=r.el=c(t.replybox(y)).click(E),s=g.find("form"),b=s.find("input[type=checkbox]")[0],v=s.find("a.ds-service-icon, a.ds-service-icon-grey"),i=et(s.find("textarea")).focus(E).keyup(eo).keyup(en).bind("focus mousedown mouseup keyup",ed),A=g.find(".ds-add-emote").click(function(s){var t=e.smiliesTooltip;return A.toggleClass("ds-expanded").hasClass("ds-expanded")?(t||(t=e.smiliesTooltip=new a.SmiliesTooltip,t.render(),e.require("smilies",function(){t.reset("微博-默认")})),t.replybox=r,t.el.appendTo(n.body).css({top:r.el.offset().top+r.el.outerHeight()+4+"px",left:r.el.find(".ds-textarea-wrapper").offset().left+"px"}),c(n.body).click(_)):_(s),!1}),_=(g.find(".ds-add-image").click(function(c){var e=i[0],t=e.value,s="请输入图片地址",r='<img src="'+s+'" />',o,a;n.selection?(e.value=t.substring(0,i.data("ds-range-start"))+r+t.substring(i.data("ds-range-end"),t.length),e.value=e.value.replace("说点什么吧 ...",""),e.focus(),o=n.selection.createRange(),o.collapse(),o.findText(s),o.select()):(e.value=t.substring(0,e.selectionStart)+r+t.substring(e.selectionEnd),a=e.value.search(s),e.setSelectionRange(a,a+s.length),e.focus()),c.preventDefault()}),r.hideSmilies=function(){A.removeClass("ds-expanded"),e.smiliesTooltip.el.detach(),c(n.body).unbind("click",_)}),M=function(a,o){var s=C(t["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:f})),i=s.el.find(".ds-dialog").css("width","320px"),n;i.find(".ds-icons-32 a").click(k),!f.deny_anonymous&&(n=s.el.find("form"),n.submit(function(){var t=n.find("input[name=author_email]").val();return!t&&!f.require_guest_email||t.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z-0-9]+\.)+[a-zA-Z]{2,}))$/)?(o(e.toJSON(n)),s.close(),!1):(alert("请输入一个有效的email地址."),!1)}),n.find("input[name=author_name]")[0].focus())},j,F,O;return f.deny_anonymous&&i.focus(function(){if(w()){M(s,j);var e=function(t){t.stopPropagation(),i.unbind("click",e)};i.click(e)}return!1}),j=function(t){z(s),d.post("posts/create",c.extend(e.toJSON(s),t),function(t){var n=m[t.response.post_id]=new N(t.response),o=I(r.postList,n,f);if("asc"==f.order==("top"==f.formPosition)&&e.scrollTo(o),p.data.comments++,p.updateCounter("duoshuo"),i.val("").trigger("keyup"),S(s),g.hasClass("ds-inline-replybox")&&(g.detach(),r.actionsBar.removeClass("ds-reply-active")),u)try{u.removeItem("ds_draft_"+p.threadId)}catch(e){}},function(e){S(s),alert(e.errorMessage)})},s.submit(function(){if(s.data("submitting"))return!1;var e=c.trim(s[0].message.value);return""==e||!h.placeholder&&e==i.attr("placeholder")?(alert("您还没写内容呢"),!1):(w()?M(s,j):j(),!1)}),F=function(e){return c(e).hasClass("ds-service-icon-grey")?null:c(e).attr("data-service")},(v.click(function(){return c(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),b.value=c.map(v,F).join(","),b.checked=""!=b.value,!1}),c(b).change(function(){var e=this.checked;v[e?"removeClass":"addClass"]("ds-service-icon-grey")[e?"addClass":"removeClass"]("ds-service-icon"),this.value=c.map(v,F).join(",")}),!T&&u)&&(O="ds_draft_"+p.threadId,i.bind("focus blur keyup",function(e){var t=c(e.currentTarget).val();try{u[O]=t}catch(e){}}),u[O]&&i.val(u[O])),this}},a.Dialog=D.extend({init:function(e,t){(this.el=c("#ds-wrapper"))[0]||(this.el=P(c('<div id="ds-wrapper"></div>'))),this.options=c.extend({width:600},t),e!==g&&c(e).attr("id","ds-reset").appendTo(this.el)},open:function(){function t(t){return 27==t.which?(e.close(),!1):void 0}function s(){return e.close(),!1}var e=this;return e.el.hide().appendTo(n.body).fadeIn(200),h.ie6&&e.el.css("top",T.scrollTop()+100),e.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return e.close(),!1}).click(V),es.keydown(t),c(n.body).click(s),e.close=function(){es.unbind("keydown",t),c(n.body).unbind("click",s),e.el.fadeOut(200,function(){c(this).remove()}),e.trigger("close")},e}}),t.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> 人喜欢":""},a.Meta=function(e){this.embedThread=e},a.Meta.prototype={render:function(){function a(p){function h(t){i.set(t),e.resetLikePanel()}function a(){e.tooltip.detach(),c(n.body).unbind("click",a)}function m(e){switch(this.className){case"ds-like-tooltip-close":a(e);break;default:if(!r.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1}var u=o.hasClass("ds-thread-liked"),f,l;return d.post("threads/vote",{thread_id:e.embedThread.threadId,vote:u?0:1},h),o.toggleClass("ds-thread-liked"),o.find(".ds-thread-like-text").text(u?"喜欢":"已喜欢"),u?(e.tooltip&&a(p),!1):(e.tooltip===g&&(f=t.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:i.data.thread_id}),e.tooltip=c(f).click(V).delegate("a","click",m)),l={},l.left=0,l.top=s.position().top+s.outerHeight()-4+"px",e.tooltip.appendTo(e.embedThread.innerEl).css(l),c(n.body).click(a),!1)}var e=this,i=e.embedThread.model,s=e.el=c(t.meta(i.toJSON())),o=s.find(".ds-like-thread-button");return o.click(a),e.resetLikePanel(),w()&&s.hide(),e},resetLikePanel:function(){this.el.find(".ds-like-panel").html(t.likePanel(this.embedThread.model.toJSON()))}},a.PostListHead=function(e){this.embedThread=e},a.PostListHead.prototype={render:function(){function r(s){i.find("a.ds-current").removeClass("ds-current"),e.params.page=1;var t=s.currentTarget;switch(t.className){case"ds-comments-tab-duoshuo":e.params.source="duoshuo",n.replybox.el.show();break;case"ds-comments-tab-repost":e.params.source="repost",n.replybox.el.hide();break;case"ds-comments-tab-weibo":e.params.source="weibo",n.replybox.el.hide();break;case"ds-comments-tab-qqt":e.params.source="qqt",n.replybox.el.hide()}return c(t).addClass("ds-current"),e.refetch(),!1}function a(){return s.find("a.ds-current").removeClass("ds-current"),e.params.order=n.options.order=this.className.replace("ds-order-",""),e.params.page=1,e.refetch(),c(this).addClass("ds-current"),!1}var n=this.embedThread,e=n.postList,o=this.el=c(t.postListHead({thread:n.model.toJSON(),options:n.options})),i=o.find("ul.ds-comments-tabs"),s;return i.delegate(".ds-tab a","click",r),s=o.find(".ds-sort"),s.delegate("a","click",a),s.find(".ds-order-"+e.params.order).addClass("ds-current"),this}},a.Paginator=function(e){function o(){return s.params.page=parseInt(this.innerHTML),s.refetch(),n.find(".ds-current").removeClass("ds-current"),c(this).addClass("ds-current"),!1}e=e||{};var t=this,n=t.el=e.el||c('<div class="ds-paginator"></div>'),s=t.collection=e.collection;n.delegate("a","click",o)},a.Paginator.prototype={reset:function(n){function o(e){s.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var e,t=this.collection.params.page||1,s=[];if(t>1)for(o(1),e=t>4?t-2:2,e>2&&s.push('<span class="page-break">...</span>');t>e;e++)o(e);if(s.push('<a data-page="'+t+'" href="javascript:void(0);" class="ds-current">'+t+"</a>"),t<n.pages){for(e=t+1;t+4>=e&&e<n.pages;e++)o(e);e<n.pages&&s.push('<span class="page-break">...</span>'),o(n.pages)}this.el.html('<div class="ds-border"></div>'+s.join(" "))[n.pages>1?"show":"hide"]()}},e.addSmilies=function(t,s){var n=e.smiliesTooltip;n&&n.el.find("ul.ds-smilies-tabs").append("<li><a>"+t+"</a></li>"),e.smilies[t]=s},a.SmiliesTooltip=function(){},a.SmiliesTooltip.prototype={render:function(){function i(){var r=e.replybox,i=r.el.find("textarea"),t=i[0],s=t.value,a,c;n.selection?(t.value=s.substring(0,i.data("ds-range-start"))+this.title+s.substring(i.data("ds-range-end"),s.length),t.value=t.value.replace(o.leave_a_message,""),t.focus(),a=n.selection.createRange(),a.moveStart("character",i.data("ds-range-start")+this.title.length),a.collapse(),a.select()):(c=t.selectionStart+this.title.length,t.value=s.substring(0,t.selectionStart)+this.title+s.substring(t.selectionEnd),t.setSelectionRange(c,c)),r.hideSmilies(),t.focus()}var e=this,s=e.el=c(t.smiliesTooltip(Q));return s.click(V).find("ul.ds-smilies-tabs").delegate("a","click",function(){e.reset(this.innerHTML)}),s.find(".ds-smilies-container").delegate("img","click",i),this},reset:function(t){function o(o,i){var s=0===t.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+i.replace("_org","_thumb"):e.STATIC_URL+"/images/smilies/"+i;document.location.protocol=="https:"&&(s=s.replace("http://","//nznlz6ohs.qnssl.com/"),s=s.replace("http://img.t.sinajs.cn/","//nznlz6ohs.qnssl.com/")),s=s.replace("_org.gif","_thumb.gif"),"WordPress"===t&&(o=" "+o+" "),n+='<li><img src="'+s+'" title="'+v(o)+'" /></li>'}var s=this.el.find("ul.ds-smilies-tabs"),n;return s.find("a.ds-current").removeClass("ds-current"),s.find("a").filter(function(){return this.innerHTML==t}).addClass("ds-current"),n="<ul>",c.each(Q[t],o),n+="</ul>",this.el.find(".ds-smilies-container").html(n),this}},t.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',o.no_comments_yet,"</li>"].join("")};var f=c('<div id="ds-bubble"><div class="ds-bubble-content"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>'),M=f.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){function s(n){function s(e,n){return t.ctxPost({post:e,index:n})}b.log(c.map(n.response,s).join("\n")),e.el.find("ol"),e.el.find("ol").html(c.map(n.response,s).join("\n"))}var n={},e;return n.post_id=M.attr("data-post-id"),d.get("posts/conversation",n,s),e=C('<h2>查看对话</h2><ol id="ds-ctx"></ol>'),e.el.find(".ds-dialog").css("width","600px"),e.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),A=bubbleOutTimer=0;f.mouseenter(q).mouseleave(Y),a.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=c('<ul class="ds-comments"></ul>')},a.PostList.prototype={url:"threads/listPosts",render:function(){return Z.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(e){var n=this.embedThread.options;this.el.html(e[0]?c.map(m.getJSON(e),function(e){return t.post({post:e,options:n})}).join(""):t.postPlaceholder())},refetch:function(){function o(t){m.set(t.parentPosts||t.relatedPosts),x.set(t.users),s.reset(t.response),s.embedThread.paginator.reset(t.cursor),s.el.fadeTo(200,1),e.scrollTo(s.el),i.remove()}var s=this,i=c(t.indicator()).appendTo(n.body).fadeIn(200);s.el.fadeTo(200,.5),d.get(s.url,s.params,o)}},a.EmbedThread=y.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(G.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){if(e=this.el,"请将此处替换成文章在你的站点中的ID"===e.data("thread-key"))return alert("请设置正确的 data-thread-key 属性"),!1;e.attr("id","ds-thread").append(t.waitingImg());var e,n=e.width(),s=e.data("url")||!e.attr("data-thread-id")&&c("link[rel=canonical]").attr("href");s?e.data("url",ei(s)):e.data("container-url",E.href),n&&400>=n&&e.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(i){function t(e){return e.substr(e.indexOf("}")+1)}var n={duoshuo:["comments",t(o.comments_multiple)||"评论"],repost:["reposts",t(o.reposts_multiple)||"转载"],weibo:["weibo_reposts",t(o.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",t(o.qqt_reposts_multiple)||"腾讯微博"]},e,s;for(e in n)(!i||i==e)&&(s=this.data[n[e][0]],this.el.find(".ds-comments-tab-"+e).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+e+'"></span>'+s:(s?'<span class="ds-highlight">'+s+"</span>":"0")+n[e][1]))},onError:function(e){this.el.html("评论框出错啦("+e.code+"): "+e.errorMessage)},onload:function(o){var n=this,u=n.threadId=o.thread.thread_id,h=o.cursor,s=n.options=o.options,i=n.innerEl=P(c('<div id="ds-reset"></div>').appendTo(n.el)),l,d;n.model=new $(n.data=o.thread),m.set(o.parentPosts||o.relatedPosts),x.set(o.users),n.el.find("#ds-waiting").remove(),s.like_thread_enabled&&(n.meta=new a.Meta(n),i.append(n.meta.render().el)),s.hot_posts&&o.hotPosts&&o.hotPosts.length&&(n.hotPosts=new a.HotPosts(c('<div class="ds-rounded"></div>'),{max_depth:1,show_context:s.show_context}),n.hotPosts.thread=n,i.append(n.hotPosts.el),n.hotPosts.onload({list:m.getJSON(o.hotPosts)})),n.postListHead=new a.PostListHead(n),n.postList=new a.PostList({embedThread:n,params:{source:"duoshuo",thread_id:u,max_depth:s.max_depth,order:s.order,limit:s.limit}}),n.postList.render().reset(o.response),n.paginator=new a.Paginator({collection:n.postList}),n.paginator.reset(h),l=n.replybox=new a.Replybox(n),l.postList=n.postList.el,w()?n.loginButtons=c(t.loginButtons()).delegate("a.ds-more-services","click",function(){return n.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",k):n.toolbar=c(t.toolbar()).delegate(".ds-account-control","mouseenter",function(){c(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){c(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var e=C(t["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return e.find("a.ds-service-link").click(k),!1}).delegate("a.ds-unread-comments-count","click",function(){return W("unread-comments"),!1}),d=['<a name="respond"></a>',n.toolbar||n.loginButtons,l.render().el],"top"==s.formPosition&&c.fn.append.apply(i,d),i.append(n.postListHead.render().el,n.postList.el,n.paginator.el),"bottom"==s.formPosition&&c.fn.append.apply(i,d),i.append(t.poweredBy(s.poweredby_text)),n.updateCounter(),o.alerts&&c.each(o.alerts,function(t,e){c('<div class="ds-alert">'+e+"</div>").insertBefore(n.toolbar||loginButtons)}),s.message&&l.el.find("textarea").val(s.message).focus(),O.on("reset",function(){var e=O.data.comments||0;i.find("a.ds-unread-comments-count").html(e).attr("title",e?"你有"+e+"条新回复":"你没有新回复").css("display",e?"inline":"none")}),s.mzadx_id&&(e.require("mzadxN",function(){}),c('<div id="MZADX_'+s.mzadx_id+'" style="margin:0 auto;"></div>').appendTo(i),__mz_rpq=r.__mz_rpq||[],__mz_rpq.push({l:[s.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}})),e.thread=n,O.data!==g&&O.trigger("reset"),w()||J.send({visit_thread_id:n.threadId})},onMessage:function(e){I(this.postList.el,new N(e),this.options)}}),a.HotPosts=y.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(e){e.options=c.extend(this.options,e.options),y.prototype.onload.call(this,e),Z.call(this.el.find("ul"),this.thread,this.options)}}),a.RecentComments=y.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(e){return{list:c.map(e.response,function(e){return new N(e).toJSON()})}}}),a.RecentVisitors=y.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-recent-visitors").append(this.waitingEl=c(t.waitingImg()))}}),a.TopThreads=y.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach(),this.el.attr("id","ds-top-threads").append(this.waitingEl=c(t.waitingImg()))}}),a.LoginWidget=y.extend({tmpl:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(t.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"])),e.find("a").click(k),e.find("a.ds-logout").attr("href",j.logoutUrl())}}),a.ThreadCount=y.extend({onload:function(s){var e=this.el,n=e.data("count-type")||"comments",t=s.data[n];e[e.data("replace")?"replaceWith":"html"](o[n+"_"+(t?t>1?"multiple":"one":"zero")].replace("{num}",t))}}),a.ShareWidget=y.extend({tmpl:"shareWidget",render:function(){var e={copyright:"多说分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share"),this.el.children().attr("id","ds-reset"),this.el.find(".ds-share-aside-inner").html(t.shareWidget(e)),this.el.find(".ds-share-icons-more").html(t.shareWidget(e)),this.el.find(".ds-share-icons-more").hide(),this.el.hasClass("flat")&&this.el.find("a").each(function(){c(this).addClass("flat")}),P(this.el),this.delegateEvents()},delegateEvents:function(){if(m=this,e=m.el,e.children().hasClass("ds-share-inline")){var m,e,l=".ds-share-icons-more",o=e.find(l),d="[data-toggle=ds-share-icons-more]",u,s,a;e.delegate(d,"mouseover",function(){o.show()}),e.delegate(d,"mouseout",function(){o.hide()}),e.delegate(l,"mouseover",function(){o.show()}),e.delegate(l,"mouseout",function(){o.hide()})}else u=e.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",s=e.children(),i.cssProperty("transition")||(a=e.children().hasClass("ds-share-aside-left")?"left":"right",e.delegate(".ds-share-aside-toggle","mouseover",function(){var e={},t=h.ie6&&"right"===a;t?e.left=(n.documentElement.scrollLeft+n.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:e[a]=0,s.animate(e,200)}),e.delegate(".ds-share-aside-inner","mouseleave",function(){var e={},t=h.ie6&&"right"===a;t?e.left=(n.documentElement.scrollLeft+n.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:e[a]=-229,s.animate(e,200)})),e.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){s.addClass(u)}),e.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){s.removeClass(u)});e.delegate("a","click",function(n){if(s=c(this).data("service"),!e.data("url"))return void alert("请设置data-url");if("wechat"===s){var s,o=p()+"/api/qrcode/getImage.png",a="?size=240&text="+e.data("url"),l=C(t["dialog-qrcode"]({qrcode_url:o+a,url:e.data("url")})),d;l.el.find(".ds-dialog").css("width","320px")}else d=p()+"/share-proxy/?"+i.param({service:c(this).data("service"),thread_key:e.data("threadKey"),title:e.data("title"),images:e.data("images"),content:e.data("content"),url:e.data("url")}),r.open(d,"_blank");n.preventDefault(),n.stopPropagation()})}}),er=0,e.initSelector=function(n,e){function s(e){R(e),i.extend(o,e.options),z.set(e.response)}var t=[];!B()||!c.isReady&&ea||c(n).each(function(l,r){var n=c(r),s,o,i;n.data("initialized")||(n.data("initialized",!0),s=new a[e.type](n,e),(el.push(s),"ThreadCount"===e.type)?(o=n.attr("data-thread-key"),n.attr("data-channel-key")&&(o=n.attr("data-channel-key")+":"+o),t.push(o),z[o]||(z[o]=new $({})),z[o].on("reset",function(){s.onload(this)})):s.uri&&(i={},c.each(s.params.split(" "),function(t,e){i[e.replace(/-/g,"_")]=n.attr("data-"+e)||n.data(e)}),d.get(s.uri,F(i),function(e){s.load(e)})))}),t.length&&d.get("threads/counts",F({threads:t.join(",")}),s)},(e.initView=function(){c.each(S,e.initSelector)})(),c(function(){if(!s){if(!B())return b.error("缺少 duoshuoQuery 的定义");b.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}setInterval(function(){c(".ds-time").each(function(){var t=c(this).attr("datetime");t&&(this.innerHTML=e.elapsedTime(t))})},2e4),s.ondomready&&s.ondomready(),e.initView(),!er&&s.short_name&&d.get("analytics/ping",F({}),R)})})}}(window,document)